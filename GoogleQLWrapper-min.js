class GoogleQLWrapper{parseCSV=t=>{try{const e=t.split("\n"),r=e[0].split(",").map((t=>t.trim().replace(/"/g,""))),a=[];for(let t=1;t<e.length;t++){const s=e[t].split(",").map((t=>t.trim().replace(/"/g,"")));if(s.length===r.length){const t={};r.forEach(((e,r)=>{t[e]=s[r]})),a.push(t)}}return a}catch(t){throw t}};constructQuery=t=>{let e="SELECT *";return t.select&&(e=`SELECT ${t.select}`),t.where&&(e+=` WHERE ${t.where}`),t.groupBy&&(e+=` Group BY ${t.groupBy}`),t.pivot&&(e+=` PIVOT ${t.pivot}`),t.orderBy&&(e+=` ORDER BY ${t.orderBy}`),t.limit&&(e+=` LIMIT ${t.limit}`),t.offset&&(e+=` OFFSET ${t.offset}`),t.label&&(e+=` LABEL ${t.label}`),encodeURIComponent(e)};getSheetData=async(t,e={})=>{try{let r=`https://docs.google.com/spreadsheets/d/${t}/gviz/tq?tqx=out:csv`;if(e.headers&&(r+=`&headers=${e.headers}`),e.gid&&(r+=`&gid=${e.gid}`),e.sheet&&(r+=`&sheet=${e.sheet}`),e.range&&(r+=`&range=${e.range}`),0!==Object.keys(e).length){r+=`&tq=${this.constructQuery(e)}`}const a=await fetch(r);if(!a.ok)throw new Error(`Failed to fetch data. Status: ${a.status}`);const s=await a.text();return this.parseCSV(s)}catch(t){throw t}};getSourceData=async(t,e)=>{try{let r=`https://docs.google.com/spreadsheets/d/${t}/gviz/tq`;e&&(r+=`?sheet=${e}`);let a=await fetch(r),s=(await a.text()).match(/google.visualization.Query.setResponse\((.*?)\);/),o=s?s[1]:"";return JSON.parse(o)}catch(t){throw t}}}export const{getSheetData:getSheetData,getSourceData:getSourceData}=new GoogleQLWrapper;