class GoogleQLWrapper{parseCSV=e=>{try{const t=e.split("\n"),r=t[0].split(",").map((e=>e.trim().replace(/"/g,""))),a=[];for(let e=1;e<t.length;e++){const o=t[e].split(",").map((e=>e.trim().replace(/"/g,"")));if(o.length===r.length){const e={};r.forEach(((t,r)=>{e[t]=o[r]})),a.push(e)}}return a}catch(e){throw e}};constructQuery=e=>{let t="SELECT *";return e.select&&(t=`SELECT ${e.select}`),e.where&&(t+=` WHERE ${e.where}`),e.groupBy&&(t+=` Group BY ${e.orderBy}`),e.pivot&&(t+=` PIVOT ${e.orderBy}`),e.orderBy&&(t+=` ORDER BY ${e.orderBy}`),e.limit&&(t+=` LIMIT ${e.orderBy}`),e.offset&&(t+=` OFFSET ${e.orderBy}`),e.label&&(t+=` LABEL ${e.orderBy}`),encodeURIComponent(t)};getSheetData=async(e,t={})=>{try{let r=`https://docs.google.com/spreadsheets/d/${e}/gviz/tq?tqx=out:csv`;if(t.headers&&(r+=`&headers=${t.headers}`),t.gid&&(r+=`&gid=${t.gid}`),t.sheet&&(r+=`&sheet=${t.sheet}`),t.range&&(r+=`&range=${t.range}`),0!==Object.keys(t).length){r+=`&tq=${this.constructQuery(t)}`}const a=await fetch(r);if(!a.ok)throw new Error(`Failed to fetch data. Status: ${a.status}`);const o=await a.text();return this.parseCSV(o)}catch(e){throw e}};getSourceData=async(e,t)=>{try{let r=`https://docs.google.com/spreadsheets/d/${e}/gviz/tq`;t&&(r+=`?sheet=${t}`);let a=await fetch(r),o=(await a.text()).match(/google.visualization.Query.setResponse\((.*?)\);/),s=o?o[1]:"";return JSON.parse(s)}catch(e){throw e}}}export const{getSheetData:getSheetData,getSourceData:getSourceData}=new GoogleQLWrapper;